<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
<title>Creating a Proxmox Debian cloud-init Template</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="G-XCHH9NNNBX">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="A step-by-step guide to setting up VM templates in Proxmox VE — learn how to create a base image, install your OS, configure it, then convert it into a reusable template for rapid VM deployment.">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:url" content="http://localhost:1313/post/proxmox-create-template/">
  <meta property="og:site_name" content="Mark Taguiad">
  <meta property="og:title" content="Creating a Proxmox Debian cloud-init Template">
  <meta property="og:description" content="A step-by-step guide to setting up VM templates in Proxmox VE — learn how to create a base image, install your OS, configure it, then convert it into a reusable template for rapid VM deployment.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-08-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-08-21T00:00:00+00:00">
    <meta property="article:tag" content="Proxmox">
    <meta property="article:tag" content="Qemu">
    <meta property="article:tag" content="Vm">
    <meta property="article:tag" content="Cloud-Init">
    <meta property="article:tag" content="Debian">






  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Creating a Proxmox Debian cloud-init Template">
  <meta name="twitter:description" content="A step-by-step guide to setting up VM templates in Proxmox VE — learn how to create a base image, install your OS, configure it, then convert it into a reusable template for rapid VM deployment.">







      <script async src="https://www.googletagmanager.com/gtag/js?id=G-XCHH9NNNBX"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-XCHH9NNNBX');
        }
      </script>




<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "abcdefghzd");
</script>



  






      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.fa793cdb4ae2d683f9cccdaf1c7922313b4cf124910b552cbc6b3a7ae3b45926.css" integrity="sha256-&#43;nk820ri1oP5zM2vHHkiMTtM8SSRC1UsvGs6euO0WSY=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">



















</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="https://gallery.marktaguiad.dev/">
                    Gallery
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#creating-a-proxmox-debian-cloud-init-template" class="nav-creating-a-proxmox-debian-cloud-init-template">
									Creating a Proxmox Debian cloud-init Template
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#background" class="nav-background">
									Background
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#table-of-contents" class="nav-table-of-contents">
									Table of Contents
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#download-the-base-image" class="nav-download-the-base-image">
									Download the base image
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#install-qemu-guest-agent" class="nav-install-qemu-guest-agent">
									Install qemu-guest-agent
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#create-proxmox-virtual-machine" class="nav-create-proxmox-virtual-machine">
									Create Proxmox virtual machine
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#covert-vm-to-template" class="nav-covert-vm-to-template">
									Covert VM to Template
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#optional-starting-the-vm" class="nav-optional-starting-the-vm">
									Optional Starting the VM
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#using-terraform-or-opentofu-to-automate-vm-creation" class="nav-using-terraform-or-opentofu-to-automate-vm-creation">
									Using Terraform or Opentofu to automate VM creation
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="http://localhost:1313/">
            Mark Taguiad
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="http://localhost:1313/">
        <div class="single-column-header-title">Mark Taguiad</div>
        
        <div class="single-column-header-subtitle">A less serious version of my website.</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('http://localhost:1313/images/featured/prox-temp.png')"
                    
                
            >
                <div class="post-title">
                    Creating a Proxmox Debian cloud-init Template
                    
                    <div class="post-subtitle">
                        A step-by-step guide to setting up VM templates in Proxmox VE — learn how to create a base image, install your OS, configure it, then convert it into a reusable template for rapid VM deployment.
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2024-08-21 00:00
                        </time>
                        

                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/proxmox">proxmox</a>
                                &nbsp;
                            
                                <a href="/tags/qemu">qemu</a>
                                &nbsp;
                            
                                <a href="/tags/vm">vm</a>
                                &nbsp;
                            
                                <a href="/tags/cloud-init">cloud-init</a>
                                &nbsp;
                            
                                <a href="/tags/debian">debian</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="creating-a-proxmox-debian-cloud-init-template">Creating a Proxmox Debian cloud-init Template</h1>
<h3 id="background">Background</h3>
<p>Finally have some time to document and publish this blog due to recent Philippines long weekend. This is the first part of the blog, as it is necessary to learn how to create template that will be used in provisioning VM and will be automatically created and deploy with Opentofu/Terraform <a href="/post/tf-tofu-proxmox">(part 2)</a>.</p>
<p>What set apart a cloud-init image vs. a fully pledge image, basically it is a clone of a miminal image. A clean installed system, that can be installed on the fly, unlike the traditional image where you have to install it using GUI or manually. With cloud-init, hostname, user/password, network and ssh-keys can be set with the config file.</p>
<h1 id="table-of-contents">Table of Contents</h1>
<ol>
<li><a href="#download-the-base-image">Download the base image</a></li>
<li><a href="#install-qemu-guest-agent">Install qemu-guest-agent</a></li>
<li><a href="#create-proxmox-virtual-machine">Create Proxmox virtual machine</a></li>
<li><a href="#covert-vm-to-template">Covert VM to Template</a></li>
<li><a href="#optional-starting-the-vm">Optional Starting the VM</a></li>
<li><a href="#using-terraform-or-opentofu-to-automate-vm-creation">Using Terraform or Opentofu to automate VM creation</a></li>
</ol>
<h3 id="download-the-base-image">Download the base image</h3>
<p>On this part you can change the image to your desired distro, but for this lab we&rsquo;ll be using Debian latest base image - <a href="https://cloud.debian.org/images/cloud/">https://cloud.debian.org/images/cloud/</a>.</p>
<pre tabindex="0"><code>wget https://cloud.debian.org/images/cloud/bookworm/20240717-1811/debian-12-generic-amd64-20240717-1811.qcow2
</code></pre><h3 id="install-qemu-guest-agent">Install qemu-guest-agent</h3>
<p>Debian cloud-init images doesn&rsquo;t include qemu-guest-agent by default. To enable it we need virt-customize tool.</p>
<p>Install package</p>
<pre tabindex="0"><code>apt install libguestfs-tools -y
</code></pre><p>Then install qemu-guest-agent to the image.</p>
<pre tabindex="0"><code>virt-customize -a debian-12-generic-amd64-20240717-1811.qcow2 --install qemu-guest-agent
</code></pre><h3 id="create-proxmox-virtual-machine">Create Proxmox virtual machine</h3>
<blockquote>
<p><strong>Note:</strong>
Value here can be changed, take note on the VM name as it will be used in part 2.</p></blockquote>
<p>Create a VM with VMID=1002, VM name with &ldquo;debian-20240717-cloudinit-template&rdquo;, with basic resources (2 core, 2048Mi ram), with a virtio adapter network.</p>
<pre tabindex="0"><code>qm create 1002 --name &#34;debian-20240717-cloudinit-template&#34; --memory 2048 --cores 2 --net0 virtio,bridge=vmbr0
</code></pre><p>Import the image to storage (storage pool will depends on you setup) and setting disk 0 to use the image.</p>
<pre tabindex="0"><code>qm importdisk 1002 debian-12-generic-amd64-20240717-1811.qcow2 tags-nvme-thin-pool1
qm set 1002 --scsihw virtio-scsi-pci --scsi0 tags-nvme-thin-pool1:vm-1002-disk-0
</code></pre><p>Set boot to disk and mounting cloudinit to ide1.</p>
<pre tabindex="0"><code>qm set 1002 --boot c --bootdisk scsi0
qm set 1002 --ide1 tags-nvme-thin-pool1:cloudinit
</code></pre><p>Set tty to serial0.</p>
<pre tabindex="0"><code>qm set 1002 --serial0 socket --vga serial0
</code></pre><p>Enable qemu-guest-agent.</p>
<pre tabindex="0"><code>qm set 1002 --agent enabled=1
</code></pre><h3 id="covert-vm-to-template">Covert VM to Template</h3>
<p>There are two ways to covert it to template.</p>
<p>Option 1: Using the terminal</p>
<pre tabindex="0"><code>qm template 1002
</code></pre><p>Option 2: GUI
Navigate to Proxmox gui, notice that VM 1002 is listed in the VM list. Click on the VM and click &lsquo;More&rsquo; option and select &lsquo;Convert to template&rsquo;.</p>
<p>At this point you can proceed to Part 2.</p>
<p>To unconvert to template, navigate to dir <code>/etc/pve/qemu-server</code>. Set template equals to 0.</p>
<pre tabindex="0"><code>vim /etc/pve/qemu-server/1001.conf

agent: enabled=1
boot: c
bootdisk: scsi0
cores: 2
ide1: tags-nvme-thin-pool1:vm-1002-cloudinit,media=cdrom
memory: 2048
meta: creation-qemu=8.1.5,ctime=1724425025
name: debian-20240717-cloudinit-template
net0: virtio=BC:24:11:90:D0:08,bridge=vmbr0
scsi0: tags-nvme-thin-pool1:base-1002-disk-0,size=2G
scsihw: virtio-scsi-pci
serial0: socket
smbios1: uuid=1c1c60fa-62c4-426d-969e-6ebe18ca1d07
template: 0
vga: serial0
vmgenid: 53e2d08a-c57f-4539-abf9-6863e2635ded
</code></pre><h3 id="optional-starting-the-vm">Optional Starting the VM</h3>
<p>Let first add ssh public key, most cloud-init image has disabled user/password login.</p>
<pre tabindex="0"><code>qm set 1002 --sshkey ~/.ssh/id_rsa.pub
</code></pre><p>Set network for the VM.</p>
<pre tabindex="0"><code>qm set 1002 --ipconfig0 ip=192.168.254.102/24,gw=192.168.254.254
</code></pre><p>To start the VM.</p>
<pre tabindex="0"><code>qm start 1002
</code></pre><p>To stop the VM.</p>
<pre tabindex="0"><code>qm stop 1002
</code></pre><p>To destroy the VM.</p>
<pre tabindex="0"><code>qm destroy 1002
</code></pre><h3 id="using-terraform-or-opentofu-to-automate-vm-creation">Using Terraform or Opentofu to automate VM creation</h3>
<p>Part 2 - <a href="/post/tf-tofu-proxmox">Automate VM Provisition with Terraform or Opentofu</a></p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2024-08-21</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/post/tf-tofu-proxmox/">
			Next<br>Automate VM Provisition with Terraform or Opentofu
                </a>
                
                
                
                <a class="older-posts" href="/post/chevereto/">
			Previous<br>Chevereto
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                












<script src="https://giscus.app/client.js"
        data-repo="mcbtaguiad/marktaguiad.dev"
        data-repo-id="R_kgDONaJdcw"
        data-category="General"
        data-category-id="DIC_kwDONaJdc84CxJdw"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>

            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="http://localhost:1313/">
    
        <div class="nav-title">
            Mark Taguiad
        </div>
        
        <div class="nav-subtitle">
            A less serious version of my website.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="https://gallery.marktaguiad.dev/">
                Gallery
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	marktaguiad.dev
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#creating-a-proxmox-debian-cloud-init-template" class="nav-creating-a-proxmox-debian-cloud-init-template">
									Creating a Proxmox Debian cloud-init Template
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#background" class="nav-background">
									Background
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#table-of-contents" class="nav-table-of-contents">
									Table of Contents
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#download-the-base-image" class="nav-download-the-base-image">
									Download the base image
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#install-qemu-guest-agent" class="nav-install-qemu-guest-agent">
									Install qemu-guest-agent
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#create-proxmox-virtual-machine" class="nav-create-proxmox-virtual-machine">
									Create Proxmox virtual machine
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#covert-vm-to-template" class="nav-covert-vm-to-template">
									Covert VM to Template
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#optional-starting-the-vm" class="nav-optional-starting-the-vm">
									Optional Starting the VM
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#using-terraform-or-opentofu-to-automate-vm-creation" class="nav-using-terraform-or-opentofu-to-automate-vm-creation">
									Using Terraform or Opentofu to automate VM creation
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	marktaguiad.dev
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
